import{c as X,r as pe,q as le,f as w,t as q,u as W,v as x,w as ee,x as ce,P as fe,y as Q,z as me,a as T,B as ve,D as ge,J as we,F as ye,G as Z,S as ke,H as g,I as h,K as re,L as N,M as be,N as Ee,O as Pe,Q as te,R as _e,n as Ue}from"./base.esm-93c22595.js";import{b as Se}from"./elliptic-574a03b9.js";const Ie="modulepreload",Oe=function(f){return"https://sam-shariat.github.io/crypto-ethereum-giftcard-nft/"+f},ae={},Je=function(r,e,n){if(!e||e.length===0)return r();const t=document.getElementsByTagName("link");return Promise.all(e.map(a=>{if(a=Oe(a),a in ae)return;ae[a]=!0;const i=a.endsWith(".css"),s=i?'[rel="stylesheet"]':"";if(!!n)for(let p=t.length-1;p>=0;p--){const d=t[p];if(d.href===a&&(!i||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${s}`))return;const u=document.createElement("link");if(u.rel=i?"stylesheet":Ie,i||(u.as="script",u.crossOrigin=""),u.href=a,document.head.appendChild(u),i)return new Promise((p,d)=>{u.addEventListener("load",p),u.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>r())};var I={},ne;function Re(){if(ne)return I;ne=1;var f=Se().ec,r=new f("secp256k1"),e=X.crypto||X.msCrypto||{},n=e.subtle||e.webkitSubtle,t=pe;const a=Buffer.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),i=Buffer.alloc(32,0);function s(c,l){if(!c)throw new Error(l||"Assertion failed")}function o(c){return Buffer.isBuffer(c)&&c.length===32}function u(c){return o(c)?c.compare(i)>0&&c.compare(a)<0:!1}function p(c,l){if(c.length!==l.length)return!1;for(var v=0,m=0;m<c.length;m++)v|=c[m]^l[m];return v===0}function d(c){var l=new Uint8Array(c);return typeof e.getRandomValues>"u"?Buffer.from(t.randomBytes(c)):(e.getRandomValues(l),Buffer.from(l))}function k(c){return new Promise(function(l){var v=t.createHash("sha512"),m=v.update(c).digest();l(new Uint8Array(m))})}function E(c){return function(l,v,m){return new Promise(function(b){if(n){var U={name:"AES-CBC"},H=n.importKey("raw",v,U,!1,[c]);return H.then(function(L){var B={name:"AES-CBC",iv:l};return n[c](B,L,m)}).then(function(L){b(Buffer.from(new Uint8Array(L)))})}else if(c==="encrypt"){var _=t.createCipheriv("aes-256-cbc",v,l);let L=_.update(m),B=_.final();b(Buffer.concat([L,B]))}else if(c==="decrypt"){var S=t.createDecipheriv("aes-256-cbc",v,l);let L=S.update(m),B=S.final();b(Buffer.concat([L,B]))}})}}var C=E("encrypt"),y=E("decrypt");function J(c,l){return new Promise(function(v){var m=t.createHmac("sha256",Buffer.from(c));m.update(l);var b=m.digest();v(b)})}function G(c,l,v){return new Promise(function(m){var b=t.createHmac("sha256",Buffer.from(c));b.update(l);var U=b.digest();m(p(U,v))})}I.generatePrivate=function(){for(var c=d(32);!u(c);)c=d(32);return c};var F=I.getPublic=function(c){return s(c.length===32,"Bad private key"),s(u(c),"Bad private key"),Buffer.from(r.keyFromPrivate(c).getPublic("arr"))};I.getPublicCompressed=function(c){s(c.length===32,"Bad private key"),s(u(c),"Bad private key");let l=!0;return Buffer.from(r.keyFromPrivate(c).getPublic(l,"arr"))},I.sign=function(c,l){return new Promise(function(v){s(c.length===32,"Bad private key"),s(u(c),"Bad private key"),s(l.length>0,"Message should not be empty"),s(l.length<=32,"Message is too long"),v(Buffer.from(r.sign(l,c,{canonical:!0}).toDER()))})},I.verify=function(c,l,v){return new Promise(function(m,b){s(c.length===65||c.length===33,"Bad public key"),c.length===65&&s(c[0]===4,"Bad public key"),c.length===33&&s(c[0]===2||c[0]===3,"Bad public key"),s(l.length>0,"Message should not be empty"),s(l.length<=32,"Message is too long"),r.verify(l,v,c)?m(null):b(new Error("Bad signature"))})};var A=I.derive=function(c,l){return new Promise(function(v){s(Buffer.isBuffer(c),"Bad private key"),s(Buffer.isBuffer(l),"Bad public key"),s(c.length===32,"Bad private key"),s(u(c),"Bad private key"),s(l.length===65||l.length===33,"Bad public key"),l.length===65&&s(l[0]===4,"Bad public key"),l.length===33&&s(l[0]===2||l[0]===3,"Bad public key");var m=r.keyFromPrivate(c),b=r.keyFromPublic(l),U=m.derive(b.getPublic());v(Buffer.from(U.toArray()))})};return I.encrypt=function(c,l,v){v=v||{};var m,b,U,H;return new Promise(function(_){for(var S=v.ephemPrivateKey||d(32);!u(S);)S=v.ephemPrivateKey||d(32);b=F(S),_(A(S,c))}).then(function(_){return k(_)}).then(function(_){m=v.iv||d(16);var S=_.slice(0,32);return H=_.slice(32),C(m,S,l)}).then(function(_){U=_;var S=Buffer.concat([m,b,U]);return J(H,S)}).then(function(_){return{iv:m,ephemPublicKey:b,ciphertext:U,mac:_}})},I.decrypt=function(c,l){var v;return A(c,l.ephemPublicKey).then(function(m){return k(m)}).then(function(m){v=m.slice(0,32);var b=m.slice(32),U=Buffer.concat([l.iv,l.ephemPublicKey,l.ciphertext]);return G(b,U,l.mac)}).then(function(m){return s(m,"Bad MAC"),y(l.iv,v,l.ciphertext)}).then(function(m){return Buffer.from(new Uint8Array(m))})},I}var $=Re(),V="openlogin-modal",M="openlogin_store",z={POPUP:"popup",REDIRECT:"redirect"},K={LOGIN:"openlogin_login",LOGOUT:"openlogin_logout",CHECK_3PC_SUPPORT:"openlogin_check_3PC_support",SET_PID_DATA:"openlogin_set_pid_data",GET_DATA:"openlogin_get_data"},O={POPUP:"popup",REDIRECT:"redirect",JRPC:"jrpc"},R={MAINNET:"mainnet",TESTNET:"testnet",CYAN:"cyan",DEVELOPMENT:"development",SK_TESTNET:"sk_testnet",CELESTE:"celeste",AQUA:"aqua"},Ge={SECP256K1:"secp256k1",ED25519:"ed25519"},Fe={GOOGLE:"google",FACEBOOK:"facebook",REDDIT:"reddit",DISCORD:"discord",TWITCH:"twitch",APPLE:"apple",LINE:"line",GITHUB:"github",KAKAO:"kakao",LINKEDIN:"linkedin",TWITTER:"twitter",WEIBO:"weibo",WECHAT:"wechat",EMAIL_PASSWORDLESS:"email_passwordless",WEBAUTHN:"webauthn",JWT:"jwt"};le.setLevel("error");var j=le.getLogger("openlogin");function ie(){return Y.apply(this,arguments)}function Y(){return Y=g(h.mark(function f(){return h.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(n){document.readyState!=="loading"?n():document.addEventListener("DOMContentLoaded",function(){n()})}));case 1:case"end":return e.stop()}},f)})),Y.apply(this,arguments)}var Le=function(r){var e=window.document.createElement("template"),n=r.trim();return e.innerHTML=n,e.content.firstChild};function Ce(){var f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,r={},e=new URL(window.location.href);e.searchParams.forEach(function(p,d){d!=="result"&&(r[d]=p)});var n=e.searchParams.get("result");if(n)try{var t=JSON.parse(x(n));Object.keys(t).forEach(function(p){r[p]=t[p]})}catch(p){j.error(p)}var a=e.hash.substring(1),i=new URL("".concat(window.location.origin,"/?").concat(a));i.searchParams.forEach(function(p,d){d!=="result"&&(r[d]=p)});var s=i.searchParams.get("result");if(s)try{var o=JSON.parse(x(s));Object.keys(o).forEach(function(p){r[p]=o[p]})}catch(p){j.error(p)}if(f){var u=window.location.origin+window.location.pathname;window.history.replaceState(null,"",u)}return r}function se(f,r){return new Promise(function(e,n){if(!r){n(new Error("Unable to open window"));return}var t=!1,a=setInterval(function(){!t&&r.closed&&(clearInterval(a),n(new Error("user closed popup")))},500),i=function s(o){var u=o.data.pid;f===u&&(window.removeEventListener("message",s),t=!0,clearInterval(a),r.close(),o.data.data&&o.data.data.error?n(new Error(o.data.data.error)):e(o.data.data))};window.addEventListener("message",i)})}function D(f){var r=f.baseURL,e=f.query,n=f.hash,t=new URL(r);if(e&&Object.keys(e).forEach(function(i){t.searchParams.append(i,e[i])}),n){var a=new URL(D({baseURL:r,query:n})).searchParams.toString();t.hash=a}return t.toString()}function he(f){var r=!1,e=0,n;try{n=window[f],r=!0,e=n.length;var t="__storage_test__";return n.setItem(t,t),n.removeItem(t),!0}catch(a){return a&&(a.code===22||a.code===1014||a.name==="QuotaExceededErro r"||a.name==="NS_ERROR_DOM_QUOTA_REACHED")&&r&&e!==0}}var Te=he("sessionStorage"),De=he("localStorage");function Ae(f){try{if(typeof document>"u")return;var r=document.createElement("link");r.href=f,r.crossOrigin="anonymous",r.type="text/html",r.rel="prefetch",r.relList&&r.relList.supports&&r.relList.supports("prefetch")&&document.head.appendChild(r)}catch(e){j.error(e)}}function oe(){var f=window.screenLeft!==void 0?window.screenLeft:window.screenX,r=window.screenTop!==void 0?window.screenTop:window.screenY,e=1200,n=700,t=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,a=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,i=1,s=Math.abs((t-e)/2/i+f),o=Math.abs((a-n)/2/i+r),u="titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=".concat(n/i,",width=").concat(e/i,",top=").concat(o,",left=").concat(s);return u}var Be=function(r,e,n){var t=function a(i){n(i),r.removeListener(e,a)};r.on(e,t)},Ne=function(){function f(r){W(this,f),w(this,"modalUrl",void 0),w(this,"iframeElem",void 0),w(this,"initialized",!1),w(this,"modalZIndex",99999),w(this,"mux",void 0),w(this,"verifierStream",void 0),this.modalUrl=r}return q(f,[{key:"init",value:function(){var r=g(h.mark(function n(){return h.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.initIFrame(this.modalUrl);case 2:this.setupStream();case 3:case"end":return a.stop()}},n,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"setupStream",value:function(){if(this.iframeElem===null)throw new Error("iframe is null");this.mux=ce(new fe({name:"modal_iframe_rpc",target:"modal_rpc",targetWindow:this.iframeElem.contentWindow,targetOrigin:new URL(this.modalUrl).origin})),this.verifierStream=this.mux.createStream("verifier")}},{key:"initIFrame",value:function(){var r=g(h.mark(function n(t){var a=this,i;return h.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,ie();case 2:return i=document.getElementById(V),i&&(i.remove(),j.info("already initialized, removing previous modal iframe")),this.iframeElem=Le(`<iframe
        id=`.concat(V,`
        class="torusIframe"
        src="`).concat(t,`"
        style="display: none; position: fixed; top: 0; right: 0; width: 100%;
        height: 100%; border: none; border-radius: 0; z-index: `).concat(this.modalZIndex.toString(),`"
      ></iframe>`)),this._hideModal(),document.body.appendChild(this.iframeElem),o.abrupt("return",new Promise(function(u){a.iframeElem.onload=function(){a.initialized=!0,u()}}));case 8:case"end":return o.stop()}},n,this)}));function e(n){return r.apply(this,arguments)}return e}()},{key:"_showModal",value:function(){var e={};e.display="block",e.position="fixed",e.width="100%",e.height="100%",e.top="0px",e.right="0px",e.left="0px",e.bottom="0px",e.border="0",e["z-index"]=this.modalZIndex,this.iframeElem.setAttribute("style",Object.entries(e).map(function(n){var t=Q(n,2),a=t[0],i=t[1];return"".concat(a,":").concat(i)}).join(";"))}},{key:"_hideModal",value:function(){var e={};e.display="none",e.position="fixed",e.width="100%",e.height="100%",e.top="0px",e.right="0px",e.left="0px",e.bottom="0px",e.border="0",e["z-index"]=this.modalZIndex,this.iframeElem.setAttribute("style",Object.entries(e).map(function(n){var t=Q(n,2),a=t[0],i=t[1];return"".concat(a,":").concat(i)}).join(";"))}},{key:"_prompt",value:function(){var r=g(h.mark(function n(t,a,i,s){var o=this,u;return h.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:this._showModal(),u=function(E){o._hideModal(),s(E)},Be(this.verifierStream,"data",u),this.verifierStream.write({name:"prompt",clientId:t,whiteLabel:a,loginConfig:i});case 4:case"end":return d.stop()}},n,this)}));function e(n,t,a,i){return r.apply(this,arguments)}return e}()},{key:"cleanup",value:function(){var r=g(h.mark(function n(){var t;return h.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,ie();case 2:t=document.getElementById(V),t&&(t.remove(),this.iframeElem=null),this.initialized=!1;case 5:case"end":return i.stop()}},n,this)}));function e(){return r.apply(this,arguments)}return e}()}]),f}(),$e=function(){function f(){W(this,f),w(this,"store",{})}return q(f,[{key:"getItem",value:function(e){return this.store[e]||null}},{key:"setItem",value:function(e,n){this.store[e]=n}}]),f}(),de=function(){function f(r,e){W(this,f),w(this,"_storeKey",M),w(this,"storage",void 0),this.storage=r,this._storeKey=e||M;try{r.getItem(e||M)||this.resetStore()}catch{}}return q(f,[{key:"toJSON",value:function(){return this.storage.getItem(this._storeKey)}},{key:"resetStore",value:function(){var e=this.getStore();return this.storage.setItem(this._storeKey,JSON.stringify({})),e}},{key:"getStore",value:function(){return JSON.parse(this.storage.getItem(this._storeKey))}},{key:"get",value:function(e){var n=JSON.parse(this.storage.getItem(this._storeKey));return n[e]}},{key:"set",value:function(e,n){var t=JSON.parse(this.storage.getItem(this._storeKey));t[e]=n,this.storage.setItem(this._storeKey,JSON.stringify(t))}}],[{key:"getInstance",value:function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"local";if(!this.instance){var t=new $e;n==="local"&&De&&(t=localStorage),n==="session"&&Te&&(t=sessionStorage);var a=e?"".concat(M,"_").concat(e):M;this.instance=new this(t,a)}return this.instance}}]),f}();w(de,"instance",void 0);function Me(f){var r=Ke();return function(){var n=te(f),t;if(r){var a=te(this).constructor;t=Reflect.construct(n,arguments,a)}else t=n.apply(this,arguments);return _e(this,t)}}function Ke(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var je=function(f){me(e,f);var r=Me(e);function e(){var n;W(this,e);for(var t=arguments.length,a=new Array(t),i=0;i<t;i++)a[i]=arguments[i];return n=r.call.apply(r,[this].concat(a)),w(T(n),"iframeElem",null),w(T(n),"rpcStream",void 0),w(T(n),"iframeUrl",void 0),w(T(n),"rpcEngine",void 0),w(T(n),"initialized",void 0),w(T(n),"mux",void 0),n}return q(e,[{key:"init",value:function(t){var a=t.iframeElem,i=t.iframeUrl;this.iframeElem=a,this.iframeUrl=i,this.setupStream(),this.initialized=!0}},{key:"setupStream",value:function(){if(this.iframeElem===null)throw new Error("iframe is null");this.rpcStream=new fe({name:"embed_rpc",target:"iframe_rpc",targetWindow:this.iframeElem.contentWindow,targetOrigin:new URL(this.iframeUrl).origin}),this.mux=ce(this.rpcStream);var t=ve();ge(t.stream,this.mux.createStream("jrpc"),t.stream,function(i){j.error("JRPC connection broken",i)});var a=new we;a.push(ye()),a.push(t.middleware),this.rpcEngine=a}},{key:"cleanup",value:function(){this.iframeElem=null,this.initialized=!1}},{key:"_rpcRequest",value:function(t,a){t.jsonrpc||(t.jsonrpc="2.0"),t.id||(t.id=Z()),this.rpcEngine.handle(t,a)}}]),e}(ke);function ue(f,r){var e=Object.keys(f);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(f);r&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(f,t).enumerable})),e.push.apply(e,n)}return e}function P(f){for(var r=1;r<arguments.length;r++){var e=arguments[r]!=null?arguments[r]:{};r%2?ue(Object(e),!0).forEach(function(n){w(f,n,e[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(e)):ue(Object(e)).forEach(function(n){Object.defineProperty(f,n,Object.getOwnPropertyDescriptor(e,n))})}return f}Ae("https://app.openlogin.com/sdk-modal");var He=function(){function f(r){var e,n,t,a,i,s,o,u,p,d,k,E;if(W(this,f),w(this,"provider",void 0),w(this,"state",void 0),w(this,"modal",void 0),this.provider=new Proxy(new je,{deleteProperty:function(){return!0}}),r._iframeUrl||(r.network===R.MAINNET?r._iframeUrl="https://app.openlogin.com":r.network===R.CYAN?r._iframeUrl="https://cyan.openlogin.com":r.network===R.TESTNET?r._iframeUrl="https://beta.openlogin.com":r.network===R.SK_TESTNET?r._iframeUrl="https://beta-sk.openlogin.com":r.network===R.CELESTE?r._iframeUrl="https://celeste.openlogin.com":r.network===R.AQUA?r._iframeUrl="https://aqua.openlogin.com":r.network===R.DEVELOPMENT&&(r._iframeUrl="http://localhost:3000")),!r._iframeUrl)throw new Error("unspecified network and iframeUrl");this.modal=new Ne("".concat(r._iframeUrl,"/sdk-modal")),this.initState(P(P({},r),{},{no3PC:(e=r.no3PC)!==null&&e!==void 0?e:!1,_iframeUrl:r._iframeUrl,_startUrl:(n=r._startUrl)!==null&&n!==void 0?n:"".concat(r._iframeUrl,"/start"),_popupUrl:(t=r._popupUrl)!==null&&t!==void 0?t:"".concat(r._iframeUrl,"/popup-window"),redirectUrl:(a=r.redirectUrl)!==null&&a!==void 0?a:"".concat(window.location.protocol,"//").concat(window.location.host).concat(window.location.pathname),uxMode:(i=r.uxMode)!==null&&i!==void 0?i:z.REDIRECT,replaceUrlOnRedirect:(s=r.replaceUrlOnRedirect)!==null&&s!==void 0?s:!0,originData:(o=r.originData)!==null&&o!==void 0?o:w({},window.location.origin,""),whiteLabel:(u=r.whiteLabel)!==null&&u!==void 0?u:{},loginConfig:(p=r.loginConfig)!==null&&p!==void 0?p:{},_storageServerUrl:(d=r._storageServerUrl)!==null&&d!==void 0?d:"https://broadcast-server.tor.us",storageKey:r.storageKey==="session"?"session":"local",_sessionNamespace:(k=r._sessionNamespace)!==null&&k!==void 0?k:"",webauthnTransports:(E=r.webauthnTransports)!==null&&E!==void 0?E:["internal"]}))}return q(f,[{key:"privKey",get:function(){return this.state.privKey?this.state.privKey.padStart(64,"0"):""}},{key:"coreKitKey",get:function(){return this.state.coreKitKey?this.state.coreKitKey.padStart(64,"0"):""}},{key:"initState",value:function(e){this.state={uxMode:e.uxMode,network:e.network,store:de.getInstance(e._sessionNamespace,e.storageKey),iframeUrl:e._iframeUrl,startUrl:e._startUrl,popupUrl:e._popupUrl,clientId:e.clientId,redirectUrl:e.redirectUrl,replaceUrlOnRedirect:e.replaceUrlOnRedirect,originData:e.originData,loginConfig:e.loginConfig,support3PC:!e.no3PC,whiteLabel:e.whiteLabel,storageServerUrl:e._storageServerUrl,sessionNamespace:e._sessionNamespace,webauthnTransports:e.webauthnTransports}}},{key:"init",value:function(){var r=g(h.mark(function n(){var t,a;return h.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return this.state.network===R.TESTNET&&console.log("%c WARNING! You are on testnet. Please set network: 'mainnet' in production","color: #FF0000"),s.next=3,Promise.all([this.modal.init(),this.updateOriginData()]);case 3:return this.provider.init({iframeElem:this.modal.iframeElem,iframeUrl:this.state.iframeUrl}),t=Ce(this.state.replaceUrlOnRedirect),t.sessionId&&this.state.store.set("sessionId",t.sessionId),s.t0=this,s.next=9,this._getData();case 9:if(s.t1=s.sent,s.t0._syncState.call(s.t0,s.t1),!this.state.support3PC){s.next=16;break}return s.next=14,this._check3PCSupport();case 14:a=s.sent,this.state.support3PC=!!a.support3PC;case 16:case"end":return s.stop()}},n,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"updateOriginData",value:function(){var r=g(h.mark(function n(){var t,a,i,s,o;return h.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return t=JSON.parse(JSON.stringify(this.state.originData)),Object.keys(t).forEach(function(d){t[d]===""&&delete t[d]}),p.next=4,Promise.all([this.getWhitelist(),this.getWhiteLabel()]);case 4:a=p.sent,i=Q(a,2),s=i[0],o=i[1],this._syncState({originData:P(P({},s),t),whiteLabel:P(P({},o),this.state.whiteLabel)});case 9:case"end":return p.stop()}},n,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"getWhitelist",value:function(){var r=g(h.mark(function n(){var t,a,i;return h.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,t=this.state.clientId,t){o.next=4;break}throw new Error("unspecified clientId");case 4:return a=new URL("https://api.developer.tor.us/whitelist"),a.searchParams.append("project_id",this.state.clientId),a.searchParams.append("network",this.state.network),o.next=9,re(a.href);case 9:return i=o.sent,o.abrupt("return",i.signed_urls);case 13:return o.prev=13,o.t0=o.catch(0),o.abrupt("return",{});case 16:case"end":return o.stop()}},n,this,[[0,13]])}));function e(){return r.apply(this,arguments)}return e}()},{key:"getWhiteLabel",value:function(){var r=g(h.mark(function n(){var t,a,i;return h.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(o.prev=0,t=this.state.clientId,t){o.next=4;break}throw new Error("unspecified clientId");case 4:return a=new URL("https://api.developer.tor.us/whitelabel"),a.searchParams.append("project_id",this.state.clientId),o.next=8,re(a.href);case 8:return i=o.sent,o.abrupt("return",i.whiteLabel);case 12:return o.prev=12,o.t0=o.catch(0),o.abrupt("return",{});case 15:case"end":return o.stop()}},n,this,[[0,12]])}));function e(){return r.apply(this,arguments)}return e}()},{key:"login",value:function(){var r=g(h.mark(function n(t){return h.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(t!=null&&t.loginProvider)){i.next=2;break}return i.abrupt("return",this._selectedLogin(t));case 2:return i.abrupt("return",this._modal(t));case 3:case"end":return i.stop()}},n,this)}));function e(n){return r.apply(this,arguments)}return e}()},{key:"_selectedLogin",value:function(){var r=g(h.mark(function n(t){var a,i,s;return h.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return a={redirectUrl:this.state.redirectUrl},i=P(P({loginProvider:t.loginProvider},a),t),u.next=4,this.request({method:K.LOGIN,allowedInteractions:[z.REDIRECT,z.POPUP],startUrl:this.state.startUrl,popupUrl:this.state.popupUrl,params:[i]});case 4:if(s=u.sent,this.state.privKey=s.privKey,!s.store){u.next=10;break}this._syncState(s),u.next=16;break;case 10:if(!(this.state.privKey&&this.state.support3PC)){u.next=16;break}return u.t0=this,u.next=14,this._getData();case 14:u.t1=u.sent,u.t0._syncState.call(u.t0,u.t1);case 16:return u.abrupt("return",{privKey:this.privKey});case 17:case"end":return u.stop()}},n,this)}));function e(n){return r.apply(this,arguments)}return e}()},{key:"logout",value:function(){var r=g(h.mark(function n(){var t,a,i,s=arguments;return h.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return t=s.length>0&&s[0]!==void 0?s[0]:{},a={},a.redirectUrl=this.state.redirectUrl,a._clientId=this.state.clientId,a.sessionId=this.state.store.get("sessionId"),t.clientId&&(a._clientId=t.clientId),t.redirectUrl!==void 0&&(a.redirectUrl=t.redirectUrl),u.next=9,this.request({method:K.LOGOUT,params:[a],startUrl:this.state.startUrl,popupUrl:this.state.popupUrl,allowedInteractions:[O.JRPC]});case 9:return i=u.sent,this._syncState({privKey:"",coreKitKey:"",walletKey:"",oAuthPrivateKey:"",tKey:"",store:{name:"",profileImage:"",dappShare:"",idToken:"",oAuthIdToken:"",oAuthAccessToken:"",sessionId:"",sessionNamespace:"",appState:""}}),u.abrupt("return",i);case 12:case"end":return u.stop()}},n,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"request",value:function(){var r=g(h.mark(function n(t){var a,i,s,o,u,p,d,k,E,C,y,J,G,F,A;return h.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(i=Z(),s=t.params,o={},s.length===1){l.next=5;break}throw new Error("request params array should have only one element");case 5:if(u=t.startUrl,p=t.popupUrl,d=t.method,k=t.allowedInteractions,k.length!==0){l.next=8;break}throw new Error("no allowed interactions");case 8:if(this.state.clientId&&(o._clientId=this.state.clientId),this.state.sessionNamespace&&(o._sessionNamespace=this.state.sessionNamespace),!this.privKey){l.next=18;break}return E={clientId:o._clientId,timestamp:Date.now().toString()},l.next=14,$.sign(Buffer.from(this.privKey,"hex"),Buffer.from(Ee("keccak256").update(JSON.stringify(E)).digest("hex"),"hex"));case 14:C=l.sent,o._user=$.getPublic(Buffer.from(this.privKey,"hex")).toString("hex"),o._userSig=be.encode(C),o._userData=E;case 18:if(o._originData=this.state.originData,o._whiteLabelData=this.state.whiteLabel,o._loginConfig=this.state.loginConfig,o._sessionId=this.state.store.get("sessionId"),o._webauthnTransports=this.state.webauthnTransports,o._sessionId||(y=Z(),o._sessionId=y,this.state.store.set("sessionId",y)),s=[P(P({},o),s[0])],!k.includes(O.JRPC)){l.next=27;break}return l.abrupt("return",this._jrpcRequest({method:d,params:s}));case 27:if(s[0]._origin=new URL((a=s[0].redirectUrl)!==null&&a!==void 0?a:this.state.redirectUrl).origin,!this.state.support3PC){l.next=32;break}return l.next=31,this._setPIDData(i,s);case 31:s=[{}];case 32:if(!(!u||!p)){l.next=34;break}throw new Error("no url for redirect / popup flow");case 34:if(this.state.uxMode!==z.REDIRECT){l.next=44;break}if(!k.includes(O.REDIRECT)){l.next=38;break}return setTimeout(function(){window.location.href=D({baseURL:u,hash:{b64Params:N(s[0]),_pid:i,_method:d}})},50),l.abrupt("return",{});case 38:if(!k.includes(O.POPUP)){l.next=42;break}return J=new URL(D({baseURL:p,hash:{b64Params:N(s[0]),_pid:i,_method:d}})),G=window.open(J.toString(),"_blank",oe()),l.abrupt("return",se(i,G));case 42:l.next=51;break;case 44:if(!k.includes(O.POPUP)){l.next=48;break}return F=new URL(D({baseURL:p,hash:{b64Params:N(s[0]),_pid:i,_method:d}})),A=window.open(F.toString(),"_blank",oe()),l.abrupt("return",se(i,A));case 48:if(!k.includes(O.REDIRECT)){l.next=51;break}return setTimeout(function(){window.location.href=D({baseURL:u,hash:{b64Params:N(s[0]),_pid:i,_method:d}})},50),l.abrupt("return",null);case 51:throw new Error("no matching allowed interactions");case 52:case"end":return l.stop()}},n,this)}));function e(n){return r.apply(this,arguments)}return e}()},{key:"_jrpcRequest",value:function(){var r=g(h.mark(function n(t){var a=this,i,s;return h.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(!(!t||ee(t)!=="object"||Array.isArray(t))){u.next=2;break}throw new Error("invalid request args");case 2:if(i=t.method,s=t.params,!(typeof i!="string"||i.length===0)){u.next=5;break}throw new Error("invalid request method");case 5:if(!(s===void 0||!Array.isArray(s))){u.next=7;break}throw new Error("invalid request params");case 7:return s.length===0&&s.push({}),u.abrupt("return",new Promise(function(p,d){a.provider._rpcRequest({method:i,params:s},Pe(p,d))}));case 9:case"end":return u.stop()}},n)}));function e(n){return r.apply(this,arguments)}return e}()},{key:"_check3PCSupport",value:function(){var r=g(h.mark(function n(){return h.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this._jrpcRequest({method:K.CHECK_3PC_SUPPORT,params:[{_originData:this.state.originData}]}));case 1:case"end":return a.stop()}},n,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_setPIDData",value:function(){var r=g(h.mark(function n(t,a){return h.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.request({allowedInteractions:[O.JRPC],method:K.SET_PID_DATA,params:[{pid:t,data:a[0]}]});case 2:case"end":return s.stop()}},n,this)}));function e(n,t){return r.apply(this,arguments)}return e}()},{key:"_getData",value:function(){var r=g(h.mark(function n(){return h.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",this.request({allowedInteractions:[O.JRPC],method:K.GET_DATA,params:[{}]}));case 1:case"end":return a.stop()}},n,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"_syncState",value:function(e){var n=this;if(e.store){if(ee(e.store)!=="object")throw new Error("expected store to be an object");Object.keys(e.store).forEach(function(a){n.state.store.set(a,e.store[a])})}var t=this.state.store;this.state=P(P(P({},this.state),e),{},{store:t})}},{key:"_modal",value:function(){var r=g(h.mark(function n(t){var a=this;return h.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",new Promise(function(o,u){a.modal._prompt(a.state.clientId,a.state.whiteLabel,a.state.loginConfig,function(){var p=g(h.mark(function d(k){var E;return h.wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!k.cancel){y.next=4;break}u(new Error("user canceled login")),y.next=14;break;case 4:return y.prev=4,y.next=7,a._selectedLogin(Ue(t,k));case 7:E=y.sent,o(E),y.next=14;break;case 11:y.prev=11,y.t0=y.catch(4),u(y.t0);case 14:case"end":return y.stop()}},d,null,[[4,11]])}));return function(d){return p.apply(this,arguments)}}())}));case 1:case"end":return s.stop()}},n)}));function e(n){return r.apply(this,arguments)}return e}()},{key:"_cleanup",value:function(){var r=g(h.mark(function n(){return h.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.modal.cleanup();case 2:this.provider.cleanup();case 3:case"end":return a.stop()}},n,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"encrypt",value:function(){var r=g(h.mark(function n(t,a){var i;return h.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(i=a,i||(i=this.privKey),/^[0-9a-fA-f]{64}$/.exec(i)){o.next=8;break}if(!(i===""||i===void 0)){o.next=7;break}throw new Error("private key cannot be empty");case 7:throw new Error("invalid private key in encrypt");case 8:return o.abrupt("return",$.encrypt($.getPublic(Buffer.from(i,"hex")),t));case 9:case"end":return o.stop()}},n,this)}));function e(n,t){return r.apply(this,arguments)}return e}()},{key:"decrypt",value:function(){var r=g(h.mark(function n(t,a){var i;return h.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(i=a,i||(i=this.privKey),/^[0-9a-fA-f]{64}$/.exec(i)){o.next=8;break}if(!(i===""||i===void 0)){o.next=7;break}throw new Error("private key cannot be empty");case 7:throw new Error("invalid private key in decrypt");case 8:return o.abrupt("return",$.decrypt(Buffer.from(i,"hex"),t));case 9:case"end":return o.stop()}},n,this)}));function e(n,t){return r.apply(this,arguments)}return e}()},{key:"getUserInfo",value:function(){var r=g(h.mark(function n(){var t,a;return h.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!this.privKey){s.next=4;break}return t=this.state.store.getStore(),a={email:t.email||"",name:t.name||"",profileImage:t.profileImage||"",aggregateVerifier:t.aggregateVerifier||"",verifier:t.verifier||"",verifierId:t.verifierId||"",typeOfLogin:t.typeOfLogin||"",dappShare:t.dappShare||"",idToken:t.idToken||"",oAuthIdToken:t.oAuthIdToken||"",oAuthAccessToken:t.oAuthAccessToken||""},s.abrupt("return",a);case 4:throw new Error("user should be logged in to fetch userInfo");case 5:case"end":return s.stop()}},n,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"getEncodedLoginUrl",value:function(){var r=g(h.mark(function n(t){var a,i,s,o,u;return h.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(a=t.redirectUrl,i=this.state.clientId,this.state.originData[origin]){d.next=5;break}return d.next=5,this.updateOriginData();case 5:return s=P({_clientId:i,_origin:new URL(a).origin,_originData:this.state.originData,redirectUrl:a},t),o=N(s),u={b64Params:o,_method:"openlogin_login"},d.abrupt("return",D({baseURL:"".concat(this.state.iframeUrl,"/start"),hash:u}));case 9:case"end":return d.stop()}},n,this)}));function e(n){return r.apply(this,arguments)}return e}()}]),f}();export{Fe as L,R as O,Ge as S,z as U,Je as _,He as a,Ce as g};
