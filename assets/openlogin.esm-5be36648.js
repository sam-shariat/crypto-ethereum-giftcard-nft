import{c as V,r as he,q as ne,f as m,t as L,u as C,v as Q,w as Z,x as ie,P as se,y as j,z as de,a as _,B as pe,D as me,J as ve,F as ge,G as q,S as we,H as d,I as c,K as Y,L as S,M as ye,N as be,O as ke,Q as X,R as Ee,n as _e}from"./base.esm-e36f3d2a.js";import{e as Pe}from"./elliptic-75fd6b2c.js";const Ue="modulepreload",Se=function(u){return"/crypto-ethereum-giftcard-nft/"+u},x={},er=function(e,r,a){if(!r||r.length===0)return e();const t=document.getElementsByTagName("link");return Promise.all(r.map(n=>{if(n=Se(n),n in x)return;x[n]=!0;const i=n.endsWith(".css"),o=i?'[rel="stylesheet"]':"";if(!!a)for(let f=t.length-1;f>=0;f--){const h=t[f];if(h.href===n&&(!i||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${o}`))return;const l=document.createElement("link");if(l.rel=i?"stylesheet":Ue,i||(l.as="script",l.crossOrigin=""),l.href=n,document.head.appendChild(l),i)return new Promise((f,h)=>{l.addEventListener("load",f),l.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>e())};var W,Ie=Pe.ec,A=new Ie("secp256k1"),N=V.crypto||V.msCrypto||{},B=N.subtle||N.webkitSubtle,U=he;const Oe=Buffer.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),Re=Buffer.alloc(32,0);function y(u,e){if(!u)throw new Error(e||"Assertion failed")}function Le(u){return Buffer.isBuffer(u)&&u.length===32}function $(u){return Le(u)?u.compare(Re)>0&&u.compare(Oe)<0:!1}function Ce(u,e){if(u.length!==e.length)return!1;for(var r=0,a=0;a<u.length;a++)r|=u[a]^e[a];return r===0}function K(u){var e=new Uint8Array(u);return typeof N.getRandomValues>"u"?Buffer.from(U.randomBytes(u)):(N.getRandomValues(e),Buffer.from(e))}function oe(u){return new Promise(function(e){var r=U.createHash("sha512"),a=r.update(u).digest();e(new Uint8Array(a))})}function ue(u){return function(e,r,a){return new Promise(function(t){if(B){var n={name:"AES-CBC"},i=B.importKey("raw",r,n,!1,[u]);return i.then(function(l){var f={name:"AES-CBC",iv:e};return B[u](f,l,a)}).then(function(l){t(Buffer.from(new Uint8Array(l)))})}else if(u==="encrypt"){var o=U.createCipheriv("aes-256-cbc",r,e);let l=o.update(a),f=o.final();t(Buffer.concat([l,f]))}else if(u==="decrypt"){var s=U.createDecipheriv("aes-256-cbc",r,e);let l=s.update(a),f=s.final();t(Buffer.concat([l,f]))}})}}var Te=ue("encrypt"),De=ue("decrypt");function Ae(u,e){return new Promise(function(r){var a=U.createHmac("sha256",Buffer.from(u));a.update(e);var t=a.digest();r(t)})}function Ne(u,e,r){return new Promise(function(a){var t=U.createHmac("sha256",Buffer.from(u));t.update(e);var n=t.digest();a(Ce(n,r))})}var $e=W=function(u){return y(u.length===32,"Bad private key"),y($(u),"Bad private key"),Buffer.from(A.keyFromPrivate(u).getPublic("arr"))},Be=function(u,e){return new Promise(function(r){y(u.length===32,"Bad private key"),y($(u),"Bad private key"),y(e.length>0,"Message should not be empty"),y(e.length<=32,"Message is too long"),r(Buffer.from(A.sign(e,u,{canonical:!0}).toDER()))})},le=function(u,e){return new Promise(function(r){y(Buffer.isBuffer(u),"Bad private key"),y(Buffer.isBuffer(e),"Bad public key"),y(u.length===32,"Bad private key"),y($(u),"Bad private key"),y(e.length===65||e.length===33,"Bad public key"),e.length===65&&y(e[0]===4,"Bad public key"),e.length===33&&y(e[0]===2||e[0]===3,"Bad public key");var a=A.keyFromPrivate(u),t=A.keyFromPublic(e),n=a.derive(t.getPublic());r(Buffer.from(n.toArray()))})},Ke=function(u,e,r){r=r||{};var a,t,n,i;return new Promise(function(o){for(var s=r.ephemPrivateKey||K(32);!$(s);)s=r.ephemPrivateKey||K(32);t=$e(s),o(le(s,u))}).then(function(o){return oe(o)}).then(function(o){a=r.iv||K(16);var s=o.slice(0,32);return i=o.slice(32),Te(a,s,e)}).then(function(o){n=o;var s=Buffer.concat([a,t,n]);return Ae(i,s)}).then(function(o){return{iv:a,ephemPublicKey:t,ciphertext:n,mac:o}})},Me=function(u,e){var r;return le(u,e.ephemPublicKey).then(function(a){return oe(a)}).then(function(a){r=a.slice(0,32);var t=a.slice(32),n=Buffer.concat([e.iv,e.ephemPublicKey,e.ciphertext]);return Ne(t,n,e.mac)}).then(function(a){return y(a,"Bad MAC"),De(e.iv,r,e.ciphertext)}).then(function(a){return Buffer.from(new Uint8Array(a))})},M="openlogin-modal",I="openlogin_store",D={POPUP:"popup",REDIRECT:"redirect"},O={LOGIN:"openlogin_login",LOGOUT:"openlogin_logout",CHECK_3PC_SUPPORT:"openlogin_check_3PC_support",SET_PID_DATA:"openlogin_set_pid_data",GET_DATA:"openlogin_get_data"},k={POPUP:"popup",REDIRECT:"redirect",JRPC:"jrpc"},E={MAINNET:"mainnet",TESTNET:"testnet",CYAN:"cyan",DEVELOPMENT:"development",SK_TESTNET:"sk_testnet",CELESTE:"celeste",AQUA:"aqua"},rr={SECP256K1:"secp256k1",ED25519:"ed25519"},tr={GOOGLE:"google",FACEBOOK:"facebook",REDDIT:"reddit",DISCORD:"discord",TWITCH:"twitch",APPLE:"apple",LINE:"line",GITHUB:"github",KAKAO:"kakao",LINKEDIN:"linkedin",TWITTER:"twitter",WEIBO:"weibo",WECHAT:"wechat",EMAIL_PASSWORDLESS:"email_passwordless",WEBAUTHN:"webauthn",JWT:"jwt"};ne.setLevel("error");var R=ne.getLogger("openlogin");function ee(){return J.apply(this,arguments)}function J(){return J=d(c.mark(function u(){return c.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise(function(a){document.readyState!=="loading"?a():document.addEventListener("DOMContentLoaded",function(){a()})}));case 1:case"end":return r.stop()}},u)})),J.apply(this,arguments)}var je=function(e){var r=window.document.createElement("template"),a=e.trim();return r.innerHTML=a,r.content.firstChild};function qe(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,e={},r=new URL(window.location.href);r.searchParams.forEach(function(f,h){h!=="result"&&(e[h]=f)});var a=r.searchParams.get("result");if(a)try{var t=JSON.parse(Q(a));Object.keys(t).forEach(function(f){e[f]=t[f]})}catch(f){R.error(f)}var n=r.hash.substring(1),i=new URL("".concat(window.location.origin,"/?").concat(n));i.searchParams.forEach(function(f,h){h!=="result"&&(e[h]=f)});var o=i.searchParams.get("result");if(o)try{var s=JSON.parse(Q(o));Object.keys(s).forEach(function(f){e[f]=s[f]})}catch(f){R.error(f)}if(u){var l=window.location.origin+window.location.pathname;window.history.replaceState(null,"",l)}return e}function re(u,e){return new Promise(function(r,a){if(!e){a(new Error("Unable to open window"));return}var t=!1,n=setInterval(function(){!t&&e.closed&&(clearInterval(n),a(new Error("user closed popup")))},500),i=function o(s){var l=s.data.pid;u===l&&(window.removeEventListener("message",o),t=!0,clearInterval(n),e.close(),s.data.data&&s.data.data.error?a(new Error(s.data.data.error)):r(s.data.data))};window.addEventListener("message",i)})}function P(u){var e=u.baseURL,r=u.query,a=u.hash,t=new URL(e);if(r&&Object.keys(r).forEach(function(i){t.searchParams.append(i,r[i])}),a){var n=new URL(P({baseURL:e,query:a})).searchParams.toString();t.hash=n}return t.toString()}function ce(u){var e=!1,r=0,a;try{a=window[u],e=!0,r=a.length;var t="__storage_test__";return a.setItem(t,t),a.removeItem(t),!0}catch(n){return n&&(n.code===22||n.code===1014||n.name==="QuotaExceededErro r"||n.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e&&r!==0}}var We=ce("sessionStorage"),Je=ce("localStorage");function Ge(u){try{if(typeof document>"u")return;var e=document.createElement("link");e.href=u,e.crossOrigin="anonymous",e.type="text/html",e.rel="prefetch",e.relList&&e.relList.supports&&e.relList.supports("prefetch")&&document.head.appendChild(e)}catch(r){R.error(r)}}function te(){var u=window.screenLeft!==void 0?window.screenLeft:window.screenX,e=window.screenTop!==void 0?window.screenTop:window.screenY,r=1200,a=700,t=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,n=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,i=1,o=Math.abs((t-r)/2/i+u),s=Math.abs((n-a)/2/i+e),l="titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=".concat(a/i,",width=").concat(r/i,",top=").concat(s,",left=").concat(o);return l}var He=function(e,r,a){var t=function n(i){a(i),e.removeListener(r,n)};e.on(r,t)},Fe=function(){function u(e){C(this,u),m(this,"modalUrl",void 0),m(this,"iframeElem",void 0),m(this,"initialized",!1),m(this,"modalZIndex",99999),m(this,"mux",void 0),m(this,"verifierStream",void 0),this.modalUrl=e}return L(u,[{key:"init",value:function(){var e=d(c.mark(function a(){return c.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.initIFrame(this.modalUrl);case 2:this.setupStream();case 3:case"end":return n.stop()}},a,this)}));function r(){return e.apply(this,arguments)}return r}()},{key:"setupStream",value:function(){if(this.iframeElem===null)throw new Error("iframe is null");this.mux=ie(new se({name:"modal_iframe_rpc",target:"modal_rpc",targetWindow:this.iframeElem.contentWindow,targetOrigin:new URL(this.modalUrl).origin})),this.verifierStream=this.mux.createStream("verifier")}},{key:"initIFrame",value:function(){var e=d(c.mark(function a(t){var n=this,i;return c.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,ee();case 2:return i=document.getElementById(M),i&&(i.remove(),R.info("already initialized, removing previous modal iframe")),this.iframeElem=je(`<iframe
        id=`.concat(M,`
        class="torusIframe"
        src="`).concat(t,`"
        style="display: none; position: fixed; top: 0; right: 0; width: 100%;
        height: 100%; border: none; border-radius: 0; z-index: `).concat(this.modalZIndex.toString(),`"
      ></iframe>`)),this._hideModal(),document.body.appendChild(this.iframeElem),s.abrupt("return",new Promise(function(l){n.iframeElem.onload=function(){n.initialized=!0,l()}}));case 8:case"end":return s.stop()}},a,this)}));function r(a){return e.apply(this,arguments)}return r}()},{key:"_showModal",value:function(){var r={};r.display="block",r.position="fixed",r.width="100%",r.height="100%",r.top="0px",r.right="0px",r.left="0px",r.bottom="0px",r.border="0",r["z-index"]=this.modalZIndex,this.iframeElem.setAttribute("style",Object.entries(r).map(function(a){var t=j(a,2),n=t[0],i=t[1];return"".concat(n,":").concat(i)}).join(";"))}},{key:"_hideModal",value:function(){var r={};r.display="none",r.position="fixed",r.width="100%",r.height="100%",r.top="0px",r.right="0px",r.left="0px",r.bottom="0px",r.border="0",r["z-index"]=this.modalZIndex,this.iframeElem.setAttribute("style",Object.entries(r).map(function(a){var t=j(a,2),n=t[0],i=t[1];return"".concat(n,":").concat(i)}).join(";"))}},{key:"_prompt",value:function(){var e=d(c.mark(function a(t,n,i,o){var s=this,l;return c.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:this._showModal(),l=function(b){s._hideModal(),o(b)},He(this.verifierStream,"data",l),this.verifierStream.write({name:"prompt",clientId:t,whiteLabel:n,loginConfig:i});case 4:case"end":return h.stop()}},a,this)}));function r(a,t,n,i){return e.apply(this,arguments)}return r}()},{key:"cleanup",value:function(){var e=d(c.mark(function a(){var t;return c.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,ee();case 2:t=document.getElementById(M),t&&(t.remove(),this.iframeElem=null),this.initialized=!1;case 5:case"end":return i.stop()}},a,this)}));function r(){return e.apply(this,arguments)}return r}()}]),u}(),ze=function(){function u(){C(this,u),m(this,"store",{})}return L(u,[{key:"getItem",value:function(r){return this.store[r]||null}},{key:"setItem",value:function(r,a){this.store[r]=a}}]),u}(),fe=function(){function u(e,r){C(this,u),m(this,"_storeKey",I),m(this,"storage",void 0),this.storage=e,this._storeKey=r||I;try{e.getItem(r||I)||this.resetStore()}catch{}}return L(u,[{key:"toJSON",value:function(){return this.storage.getItem(this._storeKey)}},{key:"resetStore",value:function(){var r=this.getStore();return this.storage.setItem(this._storeKey,JSON.stringify({})),r}},{key:"getStore",value:function(){return JSON.parse(this.storage.getItem(this._storeKey))}},{key:"get",value:function(r){var a=JSON.parse(this.storage.getItem(this._storeKey));return a[r]}},{key:"set",value:function(r,a){var t=JSON.parse(this.storage.getItem(this._storeKey));t[r]=a,this.storage.setItem(this._storeKey,JSON.stringify(t))}}],[{key:"getInstance",value:function(r){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"local";if(!this.instance){var t=new ze;a==="local"&&Je&&(t=localStorage),a==="session"&&We&&(t=sessionStorage);var n=r?"".concat(I,"_").concat(r):I;this.instance=new this(t,n)}return this.instance}}]),u}();m(fe,"instance",void 0);function Ve(u){var e=Qe();return function(){var a=X(u),t;if(e){var n=X(this).constructor;t=Reflect.construct(a,arguments,n)}else t=a.apply(this,arguments);return Ee(this,t)}}function Qe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ze=function(u){de(r,u);var e=Ve(r);function r(){var a;C(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return a=e.call.apply(e,[this].concat(n)),m(_(a),"iframeElem",null),m(_(a),"rpcStream",void 0),m(_(a),"iframeUrl",void 0),m(_(a),"rpcEngine",void 0),m(_(a),"initialized",void 0),m(_(a),"mux",void 0),a}return L(r,[{key:"init",value:function(t){var n=t.iframeElem,i=t.iframeUrl;this.iframeElem=n,this.iframeUrl=i,this.setupStream(),this.initialized=!0}},{key:"setupStream",value:function(){if(this.iframeElem===null)throw new Error("iframe is null");this.rpcStream=new se({name:"embed_rpc",target:"iframe_rpc",targetWindow:this.iframeElem.contentWindow,targetOrigin:new URL(this.iframeUrl).origin}),this.mux=ie(this.rpcStream);var t=pe();me(t.stream,this.mux.createStream("jrpc"),t.stream,function(i){R.error("JRPC connection broken",i)});var n=new ve;n.push(ge()),n.push(t.middleware),this.rpcEngine=n}},{key:"cleanup",value:function(){this.iframeElem=null,this.initialized=!1}},{key:"_rpcRequest",value:function(t,n){t.jsonrpc||(t.jsonrpc="2.0"),t.id||(t.id=q()),this.rpcEngine.handle(t,n)}}]),r}(we);function ae(u,e){var r=Object.keys(u);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(u);e&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(u,t).enumerable})),r.push.apply(r,a)}return r}function w(u){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ae(Object(r),!0).forEach(function(a){m(u,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(u,Object.getOwnPropertyDescriptors(r)):ae(Object(r)).forEach(function(a){Object.defineProperty(u,a,Object.getOwnPropertyDescriptor(r,a))})}return u}Ge("https://app.openlogin.com/sdk-modal");var ar=function(){function u(e){var r,a,t,n,i,o,s,l,f,h,g,b;if(C(this,u),m(this,"provider",void 0),m(this,"state",void 0),m(this,"modal",void 0),this.provider=new Proxy(new Ze,{deleteProperty:function(){return!0}}),e._iframeUrl||(e.network===E.MAINNET?e._iframeUrl="https://app.openlogin.com":e.network===E.CYAN?e._iframeUrl="https://cyan.openlogin.com":e.network===E.TESTNET?e._iframeUrl="https://beta.openlogin.com":e.network===E.SK_TESTNET?e._iframeUrl="https://beta-sk.openlogin.com":e.network===E.CELESTE?e._iframeUrl="https://celeste.openlogin.com":e.network===E.AQUA?e._iframeUrl="https://aqua.openlogin.com":e.network===E.DEVELOPMENT&&(e._iframeUrl="http://localhost:3000")),!e._iframeUrl)throw new Error("unspecified network and iframeUrl");this.modal=new Fe("".concat(e._iframeUrl,"/sdk-modal")),this.initState(w(w({},e),{},{no3PC:(r=e.no3PC)!==null&&r!==void 0?r:!1,_iframeUrl:e._iframeUrl,_startUrl:(a=e._startUrl)!==null&&a!==void 0?a:"".concat(e._iframeUrl,"/start"),_popupUrl:(t=e._popupUrl)!==null&&t!==void 0?t:"".concat(e._iframeUrl,"/popup-window"),redirectUrl:(n=e.redirectUrl)!==null&&n!==void 0?n:"".concat(window.location.protocol,"//").concat(window.location.host).concat(window.location.pathname),uxMode:(i=e.uxMode)!==null&&i!==void 0?i:D.REDIRECT,replaceUrlOnRedirect:(o=e.replaceUrlOnRedirect)!==null&&o!==void 0?o:!0,originData:(s=e.originData)!==null&&s!==void 0?s:m({},window.location.origin,""),whiteLabel:(l=e.whiteLabel)!==null&&l!==void 0?l:{},loginConfig:(f=e.loginConfig)!==null&&f!==void 0?f:{},_storageServerUrl:(h=e._storageServerUrl)!==null&&h!==void 0?h:"https://broadcast-server.tor.us",storageKey:e.storageKey==="session"?"session":"local",_sessionNamespace:(g=e._sessionNamespace)!==null&&g!==void 0?g:"",webauthnTransports:(b=e.webauthnTransports)!==null&&b!==void 0?b:["internal"]}))}return L(u,[{key:"privKey",get:function(){return this.state.privKey?this.state.privKey.padStart(64,"0"):""}},{key:"coreKitKey",get:function(){return this.state.coreKitKey?this.state.coreKitKey.padStart(64,"0"):""}},{key:"initState",value:function(r){this.state={uxMode:r.uxMode,network:r.network,store:fe.getInstance(r._sessionNamespace,r.storageKey),iframeUrl:r._iframeUrl,startUrl:r._startUrl,popupUrl:r._popupUrl,clientId:r.clientId,redirectUrl:r.redirectUrl,replaceUrlOnRedirect:r.replaceUrlOnRedirect,originData:r.originData,loginConfig:r.loginConfig,support3PC:!r.no3PC,whiteLabel:r.whiteLabel,storageServerUrl:r._storageServerUrl,sessionNamespace:r._sessionNamespace,webauthnTransports:r.webauthnTransports}}},{key:"init",value:function(){var e=d(c.mark(function a(){var t,n;return c.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.state.network===E.TESTNET&&console.log("%c WARNING! You are on testnet. Please set network: 'mainnet' in production","color: #FF0000"),o.next=3,Promise.all([this.modal.init(),this.updateOriginData()]);case 3:return this.provider.init({iframeElem:this.modal.iframeElem,iframeUrl:this.state.iframeUrl}),t=qe(this.state.replaceUrlOnRedirect),t.sessionId&&this.state.store.set("sessionId",t.sessionId),o.t0=this,o.next=9,this._getData();case 9:if(o.t1=o.sent,o.t0._syncState.call(o.t0,o.t1),!this.state.support3PC){o.next=16;break}return o.next=14,this._check3PCSupport();case 14:n=o.sent,this.state.support3PC=!!n.support3PC;case 16:case"end":return o.stop()}},a,this)}));function r(){return e.apply(this,arguments)}return r}()},{key:"updateOriginData",value:function(){var e=d(c.mark(function a(){var t,n,i,o,s;return c.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return t=JSON.parse(JSON.stringify(this.state.originData)),Object.keys(t).forEach(function(h){t[h]===""&&delete t[h]}),f.next=4,Promise.all([this.getWhitelist(),this.getWhiteLabel()]);case 4:n=f.sent,i=j(n,2),o=i[0],s=i[1],this._syncState({originData:w(w({},o),t),whiteLabel:w(w({},s),this.state.whiteLabel)});case 9:case"end":return f.stop()}},a,this)}));function r(){return e.apply(this,arguments)}return r}()},{key:"getWhitelist",value:function(){var e=d(c.mark(function a(){var t,n,i;return c.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(s.prev=0,t=this.state.clientId,t){s.next=4;break}throw new Error("unspecified clientId");case 4:return n=new URL("https://api.developer.tor.us/whitelist"),n.searchParams.append("project_id",this.state.clientId),n.searchParams.append("network",this.state.network),s.next=9,Y(n.href);case 9:return i=s.sent,s.abrupt("return",i.signed_urls);case 13:return s.prev=13,s.t0=s.catch(0),s.abrupt("return",{});case 16:case"end":return s.stop()}},a,this,[[0,13]])}));function r(){return e.apply(this,arguments)}return r}()},{key:"getWhiteLabel",value:function(){var e=d(c.mark(function a(){var t,n,i;return c.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(s.prev=0,t=this.state.clientId,t){s.next=4;break}throw new Error("unspecified clientId");case 4:return n=new URL("https://api.developer.tor.us/whitelabel"),n.searchParams.append("project_id",this.state.clientId),s.next=8,Y(n.href);case 8:return i=s.sent,s.abrupt("return",i.whiteLabel);case 12:return s.prev=12,s.t0=s.catch(0),s.abrupt("return",{});case 15:case"end":return s.stop()}},a,this,[[0,12]])}));function r(){return e.apply(this,arguments)}return r}()},{key:"login",value:function(){var e=d(c.mark(function a(t){return c.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(!(t!=null&&t.loginProvider)){i.next=2;break}return i.abrupt("return",this._selectedLogin(t));case 2:return i.abrupt("return",this._modal(t));case 3:case"end":return i.stop()}},a,this)}));function r(a){return e.apply(this,arguments)}return r}()},{key:"_selectedLogin",value:function(){var e=d(c.mark(function a(t){var n,i,o;return c.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return n={redirectUrl:this.state.redirectUrl},i=w(w({loginProvider:t.loginProvider},n),t),l.next=4,this.request({method:O.LOGIN,allowedInteractions:[D.REDIRECT,D.POPUP],startUrl:this.state.startUrl,popupUrl:this.state.popupUrl,params:[i]});case 4:if(o=l.sent,this.state.privKey=o.privKey,!o.store){l.next=10;break}this._syncState(o),l.next=16;break;case 10:if(!(this.state.privKey&&this.state.support3PC)){l.next=16;break}return l.t0=this,l.next=14,this._getData();case 14:l.t1=l.sent,l.t0._syncState.call(l.t0,l.t1);case 16:return l.abrupt("return",{privKey:this.privKey});case 17:case"end":return l.stop()}},a,this)}));function r(a){return e.apply(this,arguments)}return r}()},{key:"logout",value:function(){var e=d(c.mark(function a(){var t,n,i,o=arguments;return c.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return t=o.length>0&&o[0]!==void 0?o[0]:{},n={},n.redirectUrl=this.state.redirectUrl,n._clientId=this.state.clientId,n.sessionId=this.state.store.get("sessionId"),t.clientId&&(n._clientId=t.clientId),t.redirectUrl!==void 0&&(n.redirectUrl=t.redirectUrl),l.next=9,this.request({method:O.LOGOUT,params:[n],startUrl:this.state.startUrl,popupUrl:this.state.popupUrl,allowedInteractions:[k.JRPC]});case 9:return i=l.sent,this._syncState({privKey:"",coreKitKey:"",walletKey:"",oAuthPrivateKey:"",tKey:"",store:{name:"",profileImage:"",dappShare:"",idToken:"",oAuthIdToken:"",oAuthAccessToken:"",sessionId:"",sessionNamespace:"",appState:""}}),l.abrupt("return",i);case 12:case"end":return l.stop()}},a,this)}));function r(){return e.apply(this,arguments)}return r}()},{key:"request",value:function(){var e=d(c.mark(function a(t){var n,i,o,s,l,f,h,g,b,T,v,G,H,F,z;return c.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(i=q(),o=t.params,s={},o.length===1){p.next=5;break}throw new Error("request params array should have only one element");case 5:if(l=t.startUrl,f=t.popupUrl,h=t.method,g=t.allowedInteractions,g.length!==0){p.next=8;break}throw new Error("no allowed interactions");case 8:if(this.state.clientId&&(s._clientId=this.state.clientId),this.state.sessionNamespace&&(s._sessionNamespace=this.state.sessionNamespace),!this.privKey){p.next=18;break}return b={clientId:s._clientId,timestamp:Date.now().toString()},p.next=14,Be(Buffer.from(this.privKey,"hex"),Buffer.from(be("keccak256").update(JSON.stringify(b)).digest("hex"),"hex"));case 14:T=p.sent,s._user=W(Buffer.from(this.privKey,"hex")).toString("hex"),s._userSig=ye.encode(T),s._userData=b;case 18:if(s._originData=this.state.originData,s._whiteLabelData=this.state.whiteLabel,s._loginConfig=this.state.loginConfig,s._sessionId=this.state.store.get("sessionId"),s._webauthnTransports=this.state.webauthnTransports,s._sessionId||(v=q(),s._sessionId=v,this.state.store.set("sessionId",v)),o=[w(w({},s),o[0])],!g.includes(k.JRPC)){p.next=27;break}return p.abrupt("return",this._jrpcRequest({method:h,params:o}));case 27:if(o[0]._origin=new URL((n=o[0].redirectUrl)!==null&&n!==void 0?n:this.state.redirectUrl).origin,!this.state.support3PC){p.next=32;break}return p.next=31,this._setPIDData(i,o);case 31:o=[{}];case 32:if(!(!l||!f)){p.next=34;break}throw new Error("no url for redirect / popup flow");case 34:if(this.state.uxMode!==D.REDIRECT){p.next=44;break}if(!g.includes(k.REDIRECT)){p.next=38;break}return setTimeout(function(){window.location.href=P({baseURL:l,hash:{b64Params:S(o[0]),_pid:i,_method:h}})},50),p.abrupt("return",{});case 38:if(!g.includes(k.POPUP)){p.next=42;break}return G=new URL(P({baseURL:f,hash:{b64Params:S(o[0]),_pid:i,_method:h}})),H=window.open(G.toString(),"_blank",te()),p.abrupt("return",re(i,H));case 42:p.next=51;break;case 44:if(!g.includes(k.POPUP)){p.next=48;break}return F=new URL(P({baseURL:f,hash:{b64Params:S(o[0]),_pid:i,_method:h}})),z=window.open(F.toString(),"_blank",te()),p.abrupt("return",re(i,z));case 48:if(!g.includes(k.REDIRECT)){p.next=51;break}return setTimeout(function(){window.location.href=P({baseURL:l,hash:{b64Params:S(o[0]),_pid:i,_method:h}})},50),p.abrupt("return",null);case 51:throw new Error("no matching allowed interactions");case 52:case"end":return p.stop()}},a,this)}));function r(a){return e.apply(this,arguments)}return r}()},{key:"_jrpcRequest",value:function(){var e=d(c.mark(function a(t){var n=this,i,o;return c.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(!t||Z(t)!=="object"||Array.isArray(t))){l.next=2;break}throw new Error("invalid request args");case 2:if(i=t.method,o=t.params,!(typeof i!="string"||i.length===0)){l.next=5;break}throw new Error("invalid request method");case 5:if(!(o===void 0||!Array.isArray(o))){l.next=7;break}throw new Error("invalid request params");case 7:return o.length===0&&o.push({}),l.abrupt("return",new Promise(function(f,h){n.provider._rpcRequest({method:i,params:o},ke(f,h))}));case 9:case"end":return l.stop()}},a)}));function r(a){return e.apply(this,arguments)}return r}()},{key:"_check3PCSupport",value:function(){var e=d(c.mark(function a(){return c.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this._jrpcRequest({method:O.CHECK_3PC_SUPPORT,params:[{_originData:this.state.originData}]}));case 1:case"end":return n.stop()}},a,this)}));function r(){return e.apply(this,arguments)}return r}()},{key:"_setPIDData",value:function(){var e=d(c.mark(function a(t,n){return c.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.request({allowedInteractions:[k.JRPC],method:O.SET_PID_DATA,params:[{pid:t,data:n[0]}]});case 2:case"end":return o.stop()}},a,this)}));function r(a,t){return e.apply(this,arguments)}return r}()},{key:"_getData",value:function(){var e=d(c.mark(function a(){return c.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.request({allowedInteractions:[k.JRPC],method:O.GET_DATA,params:[{}]}));case 1:case"end":return n.stop()}},a,this)}));function r(){return e.apply(this,arguments)}return r}()},{key:"_syncState",value:function(r){var a=this;if(r.store){if(Z(r.store)!=="object")throw new Error("expected store to be an object");Object.keys(r.store).forEach(function(n){a.state.store.set(n,r.store[n])})}var t=this.state.store;this.state=w(w(w({},this.state),r),{},{store:t})}},{key:"_modal",value:function(){var e=d(c.mark(function a(t){var n=this;return c.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",new Promise(function(s,l){n.modal._prompt(n.state.clientId,n.state.whiteLabel,n.state.loginConfig,function(){var f=d(c.mark(function h(g){var b;return c.wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!g.cancel){v.next=4;break}l(new Error("user canceled login")),v.next=14;break;case 4:return v.prev=4,v.next=7,n._selectedLogin(_e(t,g));case 7:b=v.sent,s(b),v.next=14;break;case 11:v.prev=11,v.t0=v.catch(4),l(v.t0);case 14:case"end":return v.stop()}},h,null,[[4,11]])}));return function(h){return f.apply(this,arguments)}}())}));case 1:case"end":return o.stop()}},a)}));function r(a){return e.apply(this,arguments)}return r}()},{key:"_cleanup",value:function(){var e=d(c.mark(function a(){return c.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.modal.cleanup();case 2:this.provider.cleanup();case 3:case"end":return n.stop()}},a,this)}));function r(){return e.apply(this,arguments)}return r}()},{key:"encrypt",value:function(){var e=d(c.mark(function a(t,n){var i;return c.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(i=n,i||(i=this.privKey),/^[0-9a-fA-f]{64}$/.exec(i)){s.next=8;break}if(!(i===""||i===void 0)){s.next=7;break}throw new Error("private key cannot be empty");case 7:throw new Error("invalid private key in encrypt");case 8:return s.abrupt("return",Ke(W(Buffer.from(i,"hex")),t));case 9:case"end":return s.stop()}},a,this)}));function r(a,t){return e.apply(this,arguments)}return r}()},{key:"decrypt",value:function(){var e=d(c.mark(function a(t,n){var i;return c.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(i=n,i||(i=this.privKey),/^[0-9a-fA-f]{64}$/.exec(i)){s.next=8;break}if(!(i===""||i===void 0)){s.next=7;break}throw new Error("private key cannot be empty");case 7:throw new Error("invalid private key in decrypt");case 8:return s.abrupt("return",Me(Buffer.from(i,"hex"),t));case 9:case"end":return s.stop()}},a,this)}));function r(a,t){return e.apply(this,arguments)}return r}()},{key:"getUserInfo",value:function(){var e=d(c.mark(function a(){var t,n;return c.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this.privKey){o.next=4;break}return t=this.state.store.getStore(),n={email:t.email||"",name:t.name||"",profileImage:t.profileImage||"",aggregateVerifier:t.aggregateVerifier||"",verifier:t.verifier||"",verifierId:t.verifierId||"",typeOfLogin:t.typeOfLogin||"",dappShare:t.dappShare||"",idToken:t.idToken||"",oAuthIdToken:t.oAuthIdToken||"",oAuthAccessToken:t.oAuthAccessToken||""},o.abrupt("return",n);case 4:throw new Error("user should be logged in to fetch userInfo");case 5:case"end":return o.stop()}},a,this)}));function r(){return e.apply(this,arguments)}return r}()},{key:"getEncodedLoginUrl",value:function(){var e=d(c.mark(function a(t){var n,i,o,s,l;return c.wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(n=t.redirectUrl,i=this.state.clientId,this.state.originData[origin]){h.next=5;break}return h.next=5,this.updateOriginData();case 5:return o=w({_clientId:i,_origin:new URL(n).origin,_originData:this.state.originData,redirectUrl:n},t),s=S(o),l={b64Params:s,_method:"openlogin_login"},h.abrupt("return",P({baseURL:"".concat(this.state.iframeUrl,"/start"),hash:l}));case 9:case"end":return h.stop()}},a,this)}));function r(a){return e.apply(this,arguments)}return r}()}]),u}();export{tr as L,E as O,rr as S,D as U,er as _,ar as a,qe as g};
